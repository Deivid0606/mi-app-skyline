<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo de Productos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary:#25D366; --primary-dark:#128C7E; --secondary:#FF6B6B; --accent:#FFD166; --dark:#333; --light:#f8f9fa; --gray:#6c757d; }
        body { background-color: var(--light); color: var(--dark); line-height: 1.6; }
        header { background: linear-gradient(135deg,var(--primary),var(--primary-dark)); color:#fff; text-align:center; padding:2rem 1rem; box-shadow:0 4px 12px rgba(0,0,0,.1); position:relative; }
        h1 { font-size:2.5rem; margin-bottom:.5rem; }
        .subtitle { font-size:1.2rem; opacity:.9; }
        .admin-btn{ position:absolute; top:1rem; right:1rem; background:rgba(255,255,255,.2); border:none; color:#fff; padding:.5rem 1rem; border-radius:5px; cursor:pointer; transition:background .3s; }
        .admin-btn:hover{ background:rgba(255,255,255,.3); }
        .container{ max-width:1200px; margin:2rem auto; padding:0 1rem; }
        .products-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:2rem; }
        .product-card{ background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 4px 8px rgba(0,0,0,.1); transition:transform .3s ease, box-shadow .3s ease; cursor:pointer; }
        .product-card:hover{ transform:translateY(-5px); box-shadow:0 8px 16px rgba(0,0,0,.15); }
        .product-image-container{ width:100%; height:200px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:#f9f9f9; }
        .product-image{ width:100%; height:100%; object-fit:contain; padding:10px; }
        .product-info{ padding:1.5rem; }
        .product-title{ font-size:1.2rem; font-weight:600; margin-bottom:.5rem; color:var(--dark); height:3rem; overflow:hidden; }
        .product-price{ font-size:1.3rem; font-weight:700; color:var(--primary-dark); margin-bottom:.5rem; }
        .product-sku{ color:var(--gray); font-size:.9rem; margin-bottom:1rem; }
        .whatsapp-btn{ display:flex; align-items:center; justify-content:center; gap:8px; width:100%; padding:12px; background:var(--primary); color:#fff; border:none; border-radius:5px; font-size:1rem; font-weight:600; cursor:pointer; transition:background-color .3s ease; }
        .whatsapp-btn:hover{ background:var(--primary-dark); }
        .share-btn{ display:flex; align-items:center; justify-content:center; gap:8px; width:100%; padding:10px; background:var(--gray); color:#fff; border:none; border-radius:5px; font-size:0.9rem; font-weight:600; cursor:pointer; transition:background-color .3s ease; margin-top: 8px; }
        .share-btn:hover{ background:#5a6268; }
        .landing-page{ display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:1000; overflow-y:auto; padding:2rem; }
        .landing-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; padding-bottom:1rem; border-bottom:1px solid #eee; }
        .close-btn{ background:none; border:none; font-size:1.5rem; cursor:pointer; color:var(--gray); }
        .landing-content{ display:flex; flex-wrap:wrap; gap:2rem; }
        .landing-image-container{ flex:1; min-width:300px; max-width:500px; display:flex; align-items:center; justify-content:center; background:#f9f9f9; border-radius:10px; padding:20px; }
        .landing-image{ width:100%; max-height:400px; object-fit:contain; }
        .landing-details{ flex:1; min-width:300px; }
        .landing-title{ font-size:2rem; margin-bottom:1rem; color:var(--dark); }
        .landing-price{ font-size:1.8rem; font-weight:700; color:var(--primary-dark); margin-bottom:.5rem; }
        .landing-sku{ color:var(--gray); margin-bottom:1.5rem; }
        .landing-description{ margin-bottom:2rem; line-height:1.8; }
        .features{ margin-bottom:2rem; }
        .features h3{ margin-bottom:1rem; }
        .features ul{ list-style-type:none; }
        .features li{ margin-bottom:.5rem; display:flex; align-items:center; }
        .features li:before{ content:"‚úì"; color:var(--primary); font-weight:bold; margin-right:.5rem; }
        .purchase-form{ background:#f8f9fa; padding:2rem; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,.05); }
        .form-title{ margin-bottom:1.5rem; color:var(--dark); }
        .form-group{ margin-bottom:1.5rem; }
        .form-group label{ display:block; margin-bottom:.5rem; font-weight:500; }
        .form-control{ width:100%; padding:12px; border:1px solid #ddd; border-radius:5px; font-size:1rem; }
        .form-row{ display:flex; gap:1rem; }
        .form-row .form-group{ flex:1; }
        .total-price{ background:var(--accent); padding:1rem; border-radius:5px; margin:1.5rem 0; text-align:center; font-size:1.2rem; font-weight:700; }
        .submit-btn{ display:flex; align-items:center; justify-content:center; gap:8px; width:100%; padding:14px; background:var(--primary); color:#fff; border:none; border-radius:5px; font-size:1.1rem; font-weight:600; cursor:pointer; transition:background-color .3s ease; }
        .submit-btn:hover{ background:var(--primary-dark); }
        .admin-panel{ display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.8); z-index:2000; justify-content:center; align-items:center; }
        .admin-content{ background:#fff; padding:2rem; border-radius:10px; width:90%; max-width:800px; max-height:90vh; overflow-y:auto; }
        .admin-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; padding-bottom:1rem; border-bottom:1px solid #eee; }
        .pin-form{ margin-bottom:2rem; padding:1.5rem; background:#f8f9fa; border-radius:8px; }
        .pin-input{ display:flex; gap:.5rem; margin-bottom:1rem; }
        .pin-input input{ width:50px; height:50px; text-align:center; font-size:1.5rem; border:2px solid #ddd; border-radius:5px; }
        .pin-input input:focus{ border-color:var(--primary); outline:none; }
        .add-product-form{ display:none; }
        .products-list{ margin-top:2rem; max-height:400px; overflow-y:auto; }
        .product-item{ display:flex; justify-content:space-between; align-items:center; padding:1rem; border-bottom:1px solid #eee; }
        .product-item:last-child{ border-bottom:none; }
        .product-item-info{ flex:1; }
        .product-item-title{ font-weight:600; margin-bottom:.25rem; }
        .product-item-sku{ color:var(--gray); font-size:.9rem; }
        .product-item-price{ margin:.5rem 0; font-weight:600; color:var(--primary-dark); }
        .edit-price-form{ display:flex; gap:.5rem; margin-top:.5rem; }
        .edit-price-input{ width:120px; padding:5px; border:1px solid #ddd; border-radius:3px; }
        .edit-price-btn{ background:var(--primary); color:#fff; border:none; padding:5px 10px; border-radius:3px; cursor:pointer; }
        .admin-buttons{ display:flex; gap:.5rem; }
        .edit-btn{ background:var(--primary); color:#fff; border:none; padding:.5rem 1rem; border-radius:5px; cursor:pointer; }
        .delete-btn{ background:var(--secondary); color:#fff; border:none; padding:.5rem 1rem; border-radius:5px; cursor:pointer; }
        footer{ text-align:center; padding:2rem; margin-top:3rem; background:var(--dark); color:#fff; }
        .search-container{ margin-bottom:2rem; display:flex; gap:1rem; }
        .search-input{ flex:1; padding:12px; border:1px solid #ddd; border-radius:5px; font-size:1rem; }
        .filter-select{ padding:12px; border:1px solid #ddd; border-radius:5px; font-size:1rem; background:#fff; }
        .no-products{ text-align:center; padding:3rem; color:var(--gray); grid-column:1 / -1; }
        @media (max-width:768px){
            .products-grid{ grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:1.5rem; }
            h1{ font-size:2rem; }
            .landing-content{ flex-direction:column; }
            .form-row{ flex-direction:column; gap:0; }
            .admin-btn{ position:static; margin-top:1rem; }
            .product-item{ flex-direction:column; align-items:flex-start; gap:1rem; }
            .admin-buttons{ width:100%; justify-content:flex-end; }
            .search-container{ flex-direction:column; }
        }
        @media (max-width:480px){
            .products-grid{ grid-template-columns:1fr; }
            h1{ font-size:1.8rem; }
            .landing-page{ padding:1rem; }
            .pin-input input{ width:40px; height:40px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Cat√°logo de Productos</h1>
        <p class="subtitle">Consulta por cualquiera de nuestros productos por WhatsApp</p>
        <button class="admin-btn" id="admin-btn"><i class="fas fa-cog"></i> Administrar</button>
    </header>

    <div class="container">
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Buscar productos...">
            <select class="filter-select" id="price-filter">
                <option value="">Filtrar por precio</option>
                <option value="low">Menor precio primero</option>
                <option value="high">Mayor precio primero</option>
            </select>
        </div>
        <div class="products-grid" id="products-container"></div>
    </div>

    <!-- Landing Page -->
    <div class="landing-page" id="landing-page">
        <div class="landing-header">
            <h2 id="landing-product-title">Nombre del Producto</h2>
            <button class="close-btn" id="close-landing"><i class="fas fa-times"></i></button>
        </div>
        <div class="landing-content">
            <div class="landing-image-container">
                <img id="landing-product-image" src="" alt="Producto" class="landing-image">
            </div>
            <div class="landing-details">
                <h3 class="landing-title" id="landing-product-name">Nombre del Producto</h3>
                <p class="landing-price" id="landing-product-price">Gs. 0</p>
                <p class="landing-sku" id="landing-product-sku">SKU: XXX-XXX</p>
                <div class="landing-description" id="landing-product-description"></div>
                <div class="features">
                    <h3>Caracter√≠sticas principales:</h3>
                    <ul id="landing-product-features"></ul>
                </div>
                <div class="purchase-form">
                    <h3 class="form-title">Completa el formulario para comprar</h3>
                    <form id="purchase-form">
                        <div class="form-group">
                            <label for="customer-name">Nombre completo</label>
                            <input type="text" id="customer-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="customer-phone">Tel√©fono</label>
                            <input type="tel" id="customer-phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="customer-quantity">Cantidad</label>
                            <select id="customer-quantity" class="form-control" required>
                                <option value="">Selecciona la cantidad</option>
                                <option value="1">1 unidad</option>
                                <option value="2">2 unidades</option>
                                <option value="3">3 unidades</option>
                                <option value="4">4 unidades</option>
                                <option value="5">5 unidades</option>
                                <option value="6">6 unidades</option>
                                <option value="7">7 unidades</option>
                                <option value="8">8 unidades</option>
                                <option value="9">9 unidades</option>
                                <option value="10">10 unidades</option>
                                <option value="mas">M√°s de 10 unidades</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customer-address">Direcci√≥n de env√≠o</label>
                                <input type="text" id="customer-address" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="customer-city">Ciudad</label>
                                <input type="text" id="customer-city" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="customer-message">Mensaje adicional (opcional)</label>
                            <textarea id="customer-message" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="total-price" id="total-price">Total a pagar: Gs. 0</div>
                        <button type="submit" class="submit-btn"><i class="fab fa-whatsapp"></i> Enviar pedido por WhatsApp</button>
                        <button type="button" class="share-btn" id="share-product-btn"><i class="fas fa-share-alt"></i> Compartir este producto</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-content">
            <div class="admin-header">
                <h2>Panel de Administraci√≥n</h2>
                <button class="close-btn" id="close-admin"><i class="fas fa-times"></i></button>
            </div>

            <div class="pin-form" id="pin-form">
                <h3>Ingresa el PIN de acceso</h3>
                <div class="pin-input">
                    <input type="password" maxlength="1" id="pin1" class="pin-digit">
                    <input type="password" maxlength="1" id="pin2" class="pin-digit">
                    <input type="password" maxlength="1" id="pin3" class="pin-digit">
                    <input type="password" maxlength="1" id="pin4" class="pin-digit">
                </div>
                <button class="submit-btn" id="verify-pin">Verificar PIN</button>
                <p id="pin-error" style="color:red;margin-top:1rem;display:none;">PIN incorrecto. Intenta nuevamente.</p>
            </div>

            <div class="add-product-form" id="add-product-form">
                <h3>Agregar Nuevo Producto</h3>
                <form id="new-product-form">
                    <div class="form-group">
                        <label for="new-product-title">Nombre del Producto</label>
                        <input type="text" id="new-product-title" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="new-product-sku">SKU (debe ser √∫nico)</label>
                        <input type="text" id="new-product-sku" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="new-product-price">Precio (Guaran√≠es)</label>
                        <input type="number" id="new-product-price" class="form-control" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="new-product-image">URL de la Imagen</label>
                        <input type="url" id="new-product-image" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="new-product-description">Descripci√≥n del Producto</label>
                        <textarea id="new-product-description" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="new-product-features">Caracter√≠sticas (separadas por comas)</label>
                        <input type="text" id="new-product-features" class="form-control" placeholder="Ej: Alta calidad, Duradero, Port√°til" required>
                    </div>
                    <button type="submit" class="submit-btn"><i class="fas fa-plus"></i> Agregar Producto</button>
                </form>

                <div class="products-list">
                    <h3>Productos Actuales</h3>
                    <div id="admin-products-list"></div>
                </div>
            </div>
        </div>
    </div>

    <footer><p>&copy; 2025 Cat√°logo de Productos. Todos los derechos reservados.</p></footer>

    <script>
        // ================== AIRBAGS DE DIAGN√ìSTICO ==================
        window.addEventListener('error', (e) => {
            console.error('Error global:', e.error || e.message);
            alert('Ocurri√≥ un error inesperado. Revisa la consola (F12) para detalles.');
        });
        window.addEventListener('unhandledrejection', (e) => {
            console.error('Promise no manejada:', e.reason);
            alert('Ocurri√≥ un error inesperado (promesa). Revisa la consola.');
        });

        // ===== Persistencia =====
        const STORAGE_KEY = 'catalog_products_v2'; // Cambiado para evitar conflictos con versiones anteriores

        function saveProductsToStorage() {
            try {
                const payload = JSON.stringify(products);
                localStorage.setItem(STORAGE_KEY, payload);
                console.log('Productos guardados:', products.length);
            } catch(e){
                console.warn('No se pudo guardar en localStorage:', e);
                // Fallback: sesi√≥n (no persistente, pero evita "crash")
                try { sessionStorage.setItem(STORAGE_KEY, JSON.stringify(products)); } catch(_) {}
                alert('Error al guardar productos. Los datos podr√≠an perderse al recargar.');
            }
        }

        function loadProductsFromStorage() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY) || sessionStorage.getItem(STORAGE_KEY);
                if (raw) {
                    const arr = JSON.parse(raw);
                    if (Array.isArray(arr)) {
                        products = arr;
                        console.log('Productos cargados:', products.length);
                        return true;
                    }
                }
            } catch(e){
                console.warn('No se pudo leer Storage:', e);
            }
            return false;
        }

        // ===== Datos iniciales (por defecto) =====
        const DEFAULT_PRODUCTS = [
            {"title":"MINI ASPIRADORA","sku":"ASP-001","price":129900,"image_url":"https://cdn.shopify.com/s/files/1/0885/3012/5095/files/ChatGPT_Image_9_ago_2025_09_49_46_p.m._ee0d4101-4eb8-45cf-9b23-e5e1d8c6288c.png?v=1755580613","description":"Mini aspiradora port√°til y potente, ideal para limpiar espacios peque√±os, el auto o lugares de dif√≠cil acceso. Con bater√≠a recargable y m√∫ltiples accesorios.","features":["Port√°til y ligera","Bater√≠a recargable","M√∫ltiples accesorios","F√°cil de usar"]},
            {"title":"V-SHAPED - CINTA FACIAL","sku":"V-S-002","price":120000,"image_url":"https://cdn.shopify.com/s/files/1/0885/3012/5095/files/17420819091000332081.jpg?v=1758002125","description":"Cinta facial V-Shaped para lifting facial instant√°neo. Ayuda a reducir la apariencia de arrugas y define el contorno facial.","features":["Lifting instant√°neo","Reduce arrugas","Define contorno facial","F√°cil aplicaci√≥n"]},
            {"title":"NIVELADORAS X 4","sku":"NIVE-003","price":99000,"image_url":"https://cdn.shopify.com/s/files/1/0885/3012/5095/files/D_NQ_NP_928396-MLA76742057946_062024-O_184afc35-97d9-4de7-a312-68808e057481.webp?v=1757838613","description":"Set de 4 niveladoras profesionales para trabajos de construcci√≥n y bricolaje. Precisi√≥n garantizada y f√°cil de usar.","features":["Set de 4 unidades","Precisi√≥n profesional","Duraderas","Para m√∫ltiples usos"]},
            {"title":"PLANTILLA ORTOP√âDICA | ORTOFLEX 5D¬Æ","sku":"ORTOPIEX-004","price":159000,"image_url":"https://cdn.shopify.com/s/files/1/0885/3012/5095/files/ChatGPT_Image_8_jun_2025_01_04_14_a.m._7b2cf86c-8fe2-44ec-a98a-2f3be15ebfe9.png?v=1757832927","description":"Plantillas ortop√©dicas Ortoflex 5D con tecnolog√≠a de amortiguaci√≥n avanzada. Alivian el dolor de pies y espalda, mejorando la postura.","features":["Tecnolog√≠a 5D","Amortiguaci√≥n avanzada","Alivia dolores","Mejora postura"]},
            {"title":"MINI CAMARA SPY","sku":"SPY-005","price":179000,"image_url":"https://cdn.shopify.com/s/files/1/0885/3012/5095/files/Captura_de_pantalla_2025-07-21_013411.png?v=1757887583","description":"Mini c√°mara esp√≠a de alta definici√≥n, discreta y f√°cil de ocultar. Ideal para seguridad dom√©stica o vigilancia.","features":["Alta definici√≥n","Discreta","F√°cil de ocultar","Bater√≠a de larga duraci√≥n"]},
            {"title":"LINTERNA POTENTE CON ZOOM","sku":"LINT-006","price":189000,"image_url":"https://acdn-us.mitiendanube.com/stores/001/131/056/products/linterr1-883f44649ed5698ece16878282190084-640-0.jpg","description":"Linterna potente con zoom ajustable, ideal para camping, emergencias o trabajos de precisi√≥n. Alcance de hasta 500 metros.","features":["Zoom ajustable","Alcance 500m","Resistente al agua","Bater√≠a recargable"]},
            {"title":"COMBO DE PERFUMES / ONE MILLION / 212","sku":"PEFUM-007","price":369000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/WhatsApp_Image_2025-05-12_at_19.24.47.jpg?v=1758052245","description":"Combo exclusivo de perfumes One Million y 212. Fragancias duraderas y elegantes para ocasiones especiales.","features":["Fragancias exclusivas","Duraderas","Elegantes","Combo especial"]},
            {"title":"SOPORTE REGULABLE PARA ELECTRODOMESTICOS","sku":"SOP-008","price":145000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Captura_de_pantalla_2025-08-31_013252.png?v=1756670358","description":"Soporte regulable para electrodom√©sticos, ideal para microondas, air fryers y otros dispositivos de cocina. Ahorra espacio y organiza tu cocina.","features":["Regulable","Ahorra espacio","F√°cil instalaci√≥n","Material resistente"]},
            {"title":"PISTOLA MASAJEADORA","sku":"PIS-010","price":169000,"image_url":"https://http2.mlstatic.com/D_NQ_NP_863788-MLA78270636317_082024-O.webp","description":"Pistola masajeadora profesional para aliviar tensiones musculares. M√∫ltiples cabezales y velocidades para un masaje personalizado.","features":["Profesional","M√∫ltiples cabezales","Velocidades ajustables","Alivia tensiones"]},
            {"title":"CORRECTOR DE POSTURA X","sku":"CORREC-011","price":179000,"image_url":"https://www.skylinestoree.online/cdn/shop/files/fajacorrectora3_540x_d6e03ef1-f416-4751-aba8-e8d3bd49dd95.jpg?v=1752811848&width=600","description":"Corrector de postura ergon√≥mico que ayuda a mantener una postura correcta durante el d√≠a. Ideal para personas que trabajan sentadas.","features":["Ergon√≥mico","Ajustable","Material transpirable","Mejora postura"]},
            {"title":"üíôü¶∂ Pack Bienestar: 2 Pares de Medias Terap√©uticas","sku":"MEDIA-012","price":120000,"image_url":"https://jv7dta-ka.myshopify.com/cdn/shop/files/ChatGPTImage19ago2025_01_50_42a.m..png?v=1755579070&width=600","description":"Pack de 2 pares de medias terap√©uticas que mejoran la circulaci√≥n y reducen la fatiga en los pies. Ideales para uso diario.","features":["Mejora circulaci√≥n","Reduce fatiga","Pack de 2 pares","Material transpirable"]},
            {"title":"COMBO DIOSA","sku":"COMBO-DIOSA-013","price":295000,"image_url":"https://jv7dta-ka.myshopify.com/cdn/shop/files/Captura_de_pantalla_2025-07-22_020430_abbf3cfe-023e-4117-b3c6-284092688429.png?v=1753160734&width=493","description":"Combo Diosa con productos de belleza y cuidado personal seleccionados para realzar tu belleza natural.","features":["Productos seleccionados","Cuidado personal","Realza belleza","Combo exclusivo"]},
            {"title":"Mini GPS con im√°n y bater√≠a ‚ú® Geo Ultra","sku":"GPS-014","price":185000,"image_url":"https://jv7dta-ka.myshopify.com/cdn/shop/files/S86697bbae4184a99a675f0ad713badd8d.webp?v=1750465534&width=600","description":"Mini GPS con im√°n incorporado y bater√≠a de larga duraci√≥n. Ideal para localizar objetos importantes o mascotas.","features":["Con im√°n","Bater√≠a larga duraci√≥n","Aplicaci√≥n m√≥vil","Localizaci√≥n en tiempo real"]},
            {"title":"KIT PERFUMES: ONE MILLON, BLUE, SAUVAGE","sku":"SAUVAGE-015","price":369000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Captura_de_pantalla_2025-09-19_145822.jpg?v=1758304744","description":"Kit de perfumes con las fragancias One Million, Blue y Sauvage. Tres opciones para diferentes ocasiones y estilos.","features":["Tres fragancias","Para diferentes ocasiones","Elegantes","Duraderas"]},
            {"title":"Corte Fino/ Afilador de Cuchillos y Tijerasüî™‚úÇÔ∏è","sku":"AFI-016","price":109000,"image_url":"https://jv7dta-ka.myshopify.com/cdn/shop/files/afilador1.webp?v=1753405987&width=600","description":"Afilador profesional para cuchillos y tijeras. Mant√©n tus herramientas de corte siempre afiladas y listas para usar.","features":["Para cuchillos y tijeras","F√°cil de usar","Resultados profesionales","Seguro"]},
            {"title":"COMBO PERFUMES X2 BAD BOY + INVICTUS","sku":"BADBOY-017","price":369000,"image_url":"https://jv7dta-ka.myshopify.com/cdn/shop/files/Post_para_instagram_datos_de_pago_moderno_azul_2.png?v=1753396867&width=600","description":"Combo de perfumes Bad Boy e Invictus. Fragancias masculinas intensas y seductoras para el hombre moderno.","features":["Fragancias masculinas","Intensas","Seductoras","Combo especial"]},
            {"title":"CREMA PARA HONGO","sku":"HONGO-018","price":120000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/WhatsApp_Image_2025-06-30_at_02.07.48.jpg?v=1758810936","description":"Crema antif√∫ngica efectiva para el tratamiento de hongos en la piel. F√≥rmula cl√≠nicamente probada para resultados r√°pidos.","features":["Antif√∫ngica","Resultados r√°pidos","F√≥rmula probada","F√°cil aplicaci√≥n"]},
            {"title":"PLANTILLA NAFOING","sku":"NAF-019","price":129900,"image_url":"https://digital-world.in.ua/wa-data/public/shop/products/73/21/2173/images/9980/9980.970.jpg","description":"Plantillas NAFOING con tecnolog√≠a de amortiguaci√≥n y soporte arqueado. Ideales para el confort diario y la salud de tus pies.","features":["Amortiguaci√≥n avanzada","Soporte arqueado","Confort diario","Material de calidad"]},
            {"title":"HIDROLAVADORA PORTATIL","sku":"HIDRO-020","price":295000,"image_url":"https://m.media-amazon.com/images/I/71blwxAYH-L.jpg","description":"Hidrolavadora port√°til con potencia profesional. Ideal para limpiar autos, bicicletas, muebles y m√°s. F√°cil de transportar y usar.","features":["Port√°til","Potencia profesional","F√°cil de usar","M√∫ltiples usos"]},
            {"title":"LUCES NAVIDE√ëAS COLORIDAS CON PANEL SOLAR 10 METROS","sku":"LUCNAVI-021","price":159900,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Imagen_de_WhatsApp_2025-09-25_a_las_01.03.55_e8205f5b.jpg?v=1759102624","description":"Luces navide√±as coloridas de 10 metros con panel solar. Decoraci√≥n ecol√≥gica y econ√≥mica para tus fiestas.","features":["Panel solar","10 metros de longitud","Colores vibrantes","Ecol√≥gico"]},
            {"title":"PARLANTE TIPO JBL G4","sku":"JBL-022","price":620000,"image_url":"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSs0vkbIqtSK_Qufj8C9Y2Lf3Y0kUlelJTQJg&s","description":"Parlante Bluetooth tipo JBL G4 con sonido de alta calidad y bater√≠a de larga duraci√≥n. Ideal para fiestas y reuniones.","features":["Sonido de alta calidad","Bater√≠a larga duraci√≥n","Bluetooth","Dise√±o port√°til"]},
            {"title":"SUPER COMBO 3x1 de Perfumes para Mujeres 30MLüå∏","sku":"PER30ML-023","price":269000,"image_url":"https://jv7dta-ka.myshopify.com/cdn/shop/files/ChatGPT_Image_15_jul_2025_03_10_36_p.m..png?v=1752603067&width=713","description":"Super combo 3x1 de perfumes para mujeres en presentaci√≥n de 30ml. Tres fragancias elegantes y femeninas en un solo pack.","features":["Tres fragancias","Presentaci√≥n 30ml","Elegantes","Femeninas"]},
            {"title":"RoyalBee Wax CERA PARA MADERA Y CUERO‚ú®","sku":"BEEWAS-024","price":120000,"image_url":"https://jv7dta-ka.myshopify.com/cdn/shop/files/ChatGPT_Image_4_oct_2025_03_57_23_p.m..png?v=1759604271&width=600","description":"Cera RoyalBee para el cuidado y protecci√≥n de madera y cuero. Restaura el brillo natural y protege contra el desgaste.","features":["Para madera y cuero","Restaura brillo","Protege del desgaste","F√°cil aplicaci√≥n"]},
            {"title":"Lampara Solar + kit De Herramienta","sku":"LINKINT-025","price":169000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Imagen_de_WhatsApp_2025-10-11_a_las_23.38.41_6c489671.jpg?v=1760236797","description":"L√°mpara solar con kit de herramientas incluido. Iluminaci√≥n ecol√≥gica y herramientas b√°sicas para el hogar.","features":["Energ√≠a solar","Kit de herramientas","Ecol√≥gica","Pr√°ctica"]},
            {"title":"SOMBRILLA PARA AUTOM√ìVILES","sku":"SOMBRI-026","price":120000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Captura_de_pantalla_2025-10-13_100601.jpg?v=1760360812","description":"Sombrilla para autom√≥viles que protege el interior del calor solar. Mantiene tu auto fresco y previene el desgaste de los interiores.","features":["Protecci√≥n solar","Mantiene fresco","F√°cil de instalar","Tama√±o universal"]},
            {"title":"IRRIGADOR BUCAL","sku":"IRRI-027","price":320000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Captura_de_pantalla_2025-10-13_100619.jpg?v=1760360812","description":"Irrigador bucal para una limpieza dental profunda. Elimina restos de comida y placa bacteriana de lugares dif√≠ciles de alcanzar.","features":["Limpieza profunda","M√∫ltiples boquillas","Presi√≥n ajustable","F√°cil de usar"]},
            {"title":"Clip Nasal Anti-Ronquidosüò¥","sku":"CLIPNASAL-029","price":99000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Captura_de_pantalla_2025-10-16_085649.jpg?v=1760615829","description":"Clip nasal anti-ronquidos que mejora la respiraci√≥n durante el sue√±o. Soluci√≥n c√≥moda y efectiva para ronquidos leves.","features":["Anti-ronquidos","Mejora respiraci√≥n","C√≥modo","Efectivo"]},
            {"title":"ASIPIRADORA INTELIGENTE","sku":"ASPIRADORAINTE-29","price":279000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Imagen_de_WhatsApp_2025-10-16_a_las_11.11.48_140b0bd7.jpg?v=1760623973","description":"Aspiradora inteligente con navegaci√≥n autom√°tica y aplicaci√≥n m√≥vil. Limpia tu hogar de forma aut√≥noma y eficiente.","features":["Navegaci√≥n autom√°tica","App m√≥vil","Limpieza eficiente","Programable"]},
            {"title":"SECADOR DE ROPA PORTATIL","sku":"SECAPORT-030","price":299000,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Captura_de_pantalla_2025-10-16_112112.jpg?v=1760624483","description":"Secador de ropa port√°til, ideal para viajes o espacios peque√±os. Secado r√°pido y eficiente sin ocupar mucho espacio.","features":["Port√°til","Secado r√°pido","Compacto","Eficiente"]},
            {"title":"Ducha Port√°til Recargable Premium‚Ñ¢","sku":"Port√°til-ducha-001","price":220000,"image_url":"https://cdn.shopify.com/s/files/1/0885/3012/5095/files/Imagen_de_WhatsApp_2025-10-17_a_las_17.51.23_4c050991.jpg?v=1760734483","description":"Ducha port√°til recargable premium para camping, playa o emergencias. Presi√≥n constante y f√°cil de transportar.","features":["Recargable","Presi√≥n constante","Port√°til","Premium"]},
            {"title":"Luz Navide√±a con Panel Solar","sku":"luzsolar-002","price":159900,"image_url":"https://cdn.shopify.com/s/files/1/0707/1979/9484/files/Imagen_de_WhatsApp_2025-09-25_a_las_01.03.55_e8205f5b.jpg?v=1759102624","description":"Luces navide√±as con panel solar para decoraci√≥n ecol√≥gica. Autom√°ticas y con m√∫ltiples modos de iluminaci√≥n.","features":["Panel solar","Autom√°ticas","M√∫ltiples modos","Ecol√≥gicas"]}
        ];

        // ===== Config =====
        const whatsappNumber = "595993637616";
        const ADMIN_PIN = "9662";

        // ===== Estado =====
        let products = [];
        let currentProduct = null;
        let editingPriceIndex = -1;
        let filteredProducts = [];

        // ===== Utils =====
        function formatPrice(price){
            const n = Number(price);
            if (!Number.isFinite(n)) return '0';
            return new Intl.NumberFormat('es-PY').format(n);
        }

        // ===== Sistema de URLs para productos =====
        function updateURL(sku = null) {
            const baseUrl = window.location.origin + window.location.pathname;
            const newUrl = sku ? `${baseUrl}?product=${encodeURIComponent(sku)}` : baseUrl;
            window.history.replaceState({}, '', newUrl);
        }

        function getProductFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const productSKU = urlParams.get('product');
            if (productSKU) {
                return products.find(p => p.sku === productSKU);
            }
            return null;
        }

        function shareProduct(product) {
            const productUrl = `${window.location.origin}${window.location.pathname}?product=${encodeURIComponent(product.sku)}`;
            if (navigator.share) {
                navigator.share({
                    title: product.title,
                    text: product.description,
                    url: productUrl
                }).catch(err => {
                    console.log('Error al compartir:', err);
                    copyToClipboard(productUrl);
                });
            } else {
                copyToClipboard(productUrl);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('¬°Enlace copiado al portapapeles! Puedes compartirlo ahora.');
            }).catch(err => {
                // Fallback para navegadores antiguos
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('¬°Enlace copiado al portapapeles! Puedes compartirlo ahora.');
            });
        }

        // ===== Filtros =====
        function filterProducts(){
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const priceFilter = document.getElementById('price-filter').value;

            filteredProducts = !searchTerm ? [...products] :
                products.filter(p => (p.title||'').toLowerCase().includes(searchTerm)
                                  || (p.sku||'').toLowerCase().includes(searchTerm)
                                  || (p.description||'').toLowerCase().includes(searchTerm));

            if (priceFilter === 'low') filteredProducts.sort((a,b)=>a.price-b.price);
            if (priceFilter === 'high') filteredProducts.sort((a,b)=>b.price-a.price);

            generateCatalog();
        }

        // ===== Cat√°logo =====
        function generateCatalog(){
            const container = document.getElementById('products-container');
            if (filteredProducts.length === 0){
                container.innerHTML = `
                    <div class="no-products">
                        <i class="fas fa-search" style="font-size:3rem;margin-bottom:1rem;"></i>
                        <h3>No se encontraron productos</h3>
                        <p>Intenta con otros t√©rminos de b√∫squeda</p>
                    </div>`;
                return;
            }
            container.innerHTML = '';
            filteredProducts.forEach(product=>{
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                const imageUrl = product.image_url || 'https://via.placeholder.com/300x200?text=Imagen+No+Disponible';
                productCard.innerHTML = `
                    <div class="product-image-container">
                        <img src="${imageUrl}" alt="${product.title}" class="product-image"
                             onerror="this.src='https://via.placeholder.com/300x200?text=Error+al+cargar+imagen'">
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.title}</h3>
                        <p class="product-price">Gs. ${formatPrice(product.price)}</p>
                        <p class="product-sku">SKU: ${product.sku}</p>
                        <button class="whatsapp-btn" data-product='${JSON.stringify(product).replace(/'/g,"&#39;")}'>
                            <i class="fab fa-whatsapp"></i> Ver producto
                        </button>
                        <button class="share-btn" data-product='${JSON.stringify(product).replace(/'/g,"&#39;")}'>
                            <i class="fas fa-share-alt"></i> Compartir
                        </button>
                    </div>`;
                container.appendChild(productCard);
            });

            // Event listeners para botones
            document.querySelectorAll('.whatsapp-btn').forEach(btn=>{
                btn.addEventListener('click', function(){
                    const productData = JSON.parse(this.getAttribute('data-product').replace(/&#39;/g,"'"));
                    openLandingPage(productData);
                });
            });

            document.querySelectorAll('.share-btn').forEach(btn=>{
                btn.addEventListener('click', function(){
                    const productData = JSON.parse(this.getAttribute('data-product').replace(/&#39;/g,"'"));
                    shareProduct(productData);
                });
            });
        }

        // ===== Landing =====
        function openLandingPage(product){
            currentProduct = product;
            updateURL(product.sku); // Actualizar URL con el SKU del producto

            document.getElementById('landing-product-title').textContent = product.title;
            document.getElementById('landing-product-name').textContent = product.title;
            document.getElementById('landing-product-price').textContent = `Gs. ${formatPrice(product.price)}`;
            document.getElementById('landing-product-sku').textContent = `SKU: ${product.sku}`;
            const imageUrl = product.image_url || 'https://via.placeholder.com/500x400?text=Imagen+No+Disponible';
            const img = document.getElementById('landing-product-image');
            img.src = imageUrl; img.alt = product.title;

            const descEl = document.getElementById('landing-product-description');
            descEl.innerHTML = `<p>${product.description || 'Producto de alta calidad.'}</p>`;

            const featuresEl = document.getElementById('landing-product-features');
            featuresEl.innerHTML = '';
            const feats = (product.features && product.features.length) ? product.features : [
                "Alta durabilidad y resistencia","Dise√±o ergon√≥mico y moderno","F√°cil de usar y mantener","Garant√≠a incluida"
            ];
            feats.forEach(f=>{ const li=document.createElement('li'); li.textContent=f; featuresEl.appendChild(li); });

            updateTotalPrice();
            document.getElementById('landing-page').style.display='block';
            document.body.style.overflow='hidden';
        }

        function updateTotalPrice(){
            const quantity = document.getElementById('customer-quantity').value;
            const totalElement = document.getElementById('total-price');
            if (quantity === 'mas'){ totalElement.textContent='Total a pagar: Consultar por m√°s de 10 unidades'; return; }
            if (quantity && currentProduct){
                const total = Number(currentProduct.price) * parseInt(quantity,10);
                totalElement.textContent = `Total a pagar: Gs. ${formatPrice(total)}`;
            } else totalElement.textContent = 'Total a pagar: Gs. 0';
        }

        function closeLandingPage(){
            updateURL(); // Limpiar URL al cerrar
            document.getElementById('landing-page').style.display='none';
            document.body.style.overflow='auto';
            document.getElementById('purchase-form').reset();
            document.getElementById('total-price').textContent='Total a pagar: Gs. 0';
            currentProduct = null;
        }

        function submitForm(e){
            e.preventDefault();
            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const quantity = document.getElementById('customer-quantity').value;
            const address = document.getElementById('customer-address').value;
            const city = document.getElementById('customer-city').value;
            const message = document.getElementById('customer-message').value;

            let total = 0, quantityText = quantity;
            if (quantity !== 'mas'){ total = Number(currentProduct.price) * parseInt(quantity,10); quantityText = `${quantity} unidad(es)`; }

            const whatsappMessage = `Hola, estoy interesado en comprar el siguiente producto:

*Producto:* ${currentProduct.title}
*SKU:* ${currentProduct.sku}
*Precio unitario:* Gs. ${formatPrice(currentProduct.price)}
*Cantidad:* ${quantityText}
${quantity !== 'mas' ? `*Total a pagar:* Gs. ${formatPrice(total)}` : ''}

*Mis datos:*
- *Nombre:* ${name}
- *Tel√©fono:* ${phone}
- *Direcci√≥n:* ${address}
- *Ciudad:* ${city}
${message ? `- *Mensaje adicional:* ${message}` : ''}

Por favor, cont√°ctenme para proceder con la compra. ¬°Gracias!`;
            const encoded = encodeURIComponent(whatsappMessage);
            const link = `https://wa.me/${whatsappNumber}?text=${encoded}`;
            window.open(link, '_blank');
            setTimeout(()=>{ closeLandingPage(); alert('¬°Gracias por tu pedido! Te contactaremos pronto por WhatsApp.'); }, 1000);
        }

        // ===== Admin =====
        function openAdminPanel(){
            document.getElementById('admin-panel').style.display='flex';
            document.getElementById('pin-form').style.display='block';
            document.getElementById('add-product-form').style.display='none';
            document.getElementById('pin-error').style.display='none';
            document.querySelectorAll('.pin-digit').forEach(i=>i.value='');
            document.getElementById('pin1').focus();
        }

        function closeAdminPanel(){
            document.getElementById('admin-panel').style.display='none';
            document.getElementById('new-product-form').reset();
            editingPriceIndex = -1;
        }

        function verifyPin(){
            const enteredPin = ['pin1','pin2','pin3','pin4'].map(id=>document.getElementById(id).value).join('');
            if (enteredPin === ADMIN_PIN){
                document.getElementById('pin-form').style.display='none';
                document.getElementById('add-product-form').style.display='block';
                updateAdminProductsList();
            } else {
                document.getElementById('pin-error').style.display='block';
                document.querySelectorAll('.pin-digit').forEach(i=>i.value='');
                document.getElementById('pin1').focus();
            }
        }

        function addNewProduct(e){
            e.preventDefault();

            const title = (document.getElementById('new-product-title').value || '').trim();
            const sku = (document.getElementById('new-product-sku').value || '').trim();
            const priceRaw = document.getElementById('new-product-price').value;
            const image_url = (document.getElementById('new-product-image').value || '').trim();
            const description = (document.getElementById('new-product-description').value || '').trim();
            const featuresRaw = (document.getElementById('new-product-features').value || '').trim();

            const price = Number(priceRaw);
            if (!title || !sku || !Number.isFinite(price) || price < 0 || !image_url || !description) {
                alert('Completa todos los campos y usa un precio v√°lido (n√∫mero ‚â• 0).');
                return;
            }
            if (products.some(p=> p.sku === sku)){
                alert('Ya existe un producto con ese SKU. Usa un SKU √∫nico.');
                return;
            }

            const features = featuresRaw
                ? featuresRaw.split(',').map(f => f.trim()).filter(Boolean)
                : [];

            const newProduct = { title, sku, price, image_url, description, features };

            try {
                products.push(newProduct);
                saveProductsToStorage();
                updateAdminProductsList();
                filteredProducts = [...products];
                generateCatalog();
                document.getElementById('new-product-form').reset();
                alert('Producto agregado correctamente');
            } catch(err){
                console.error('Error agregando producto:', err);
                alert('No se pudo agregar el producto. Revisa la consola para m√°s detalles.');
            }
        }

        function updateAdminProductsList(){
            const container = document.getElementById('admin-products-list');
            container.innerHTML = '';
            products.forEach((product,index)=>{
                const item = document.createElement('div');
                item.className = 'product-item';
                const isEditing = editingPriceIndex === index;
                item.innerHTML = `
                    <div class="product-item-info">
                        <div class="product-item-title">${product.title}</div>
                        <div class="product-item-sku">SKU: ${product.sku}</div>
                        <div class="product-item-price">
                            ${isEditing ?
                                `<div class="edit-price-form">
                                    <input type="number" class="edit-price-input" value="${product.price}" min="0" id="edit-price-${index}">
                                    <button class="edit-price-btn" onclick="savePrice(${index})">Guardar</button>
                                    <button class="edit-price-btn" style="background: var(--gray)" onclick="cancelEditPrice()">Cancelar</button>
                                </div>` :
                                `Precio: Gs. ${formatPrice(product.price)}`
                            }
                        </div>
                    </div>
                    <div class="admin-buttons">
                        ${!isEditing ? `<button class="edit-btn" onclick="editPrice(${index})"><i class="fas fa-edit"></i> Editar Precio</button>` : ''}
                        <button class="delete-btn" onclick="deleteProduct(${index})"><i class="fas fa-trash"></i> Eliminar</button>
                    </div>`;
                container.appendChild(item);
            });
        }

        function editPrice(index){
            editingPriceIndex = index;
            updateAdminProductsList();
        }

        function savePrice(index){
            const val = document.getElementById(`edit-price-${index}`).value;
            const newPrice = Number(val);
            if (!Number.isFinite(newPrice) || newPrice < 0){
                alert('Por favor ingresa un precio v√°lido');
                return;
            }
            products[index].price = newPrice;
            editingPriceIndex = -1;
            saveProductsToStorage();
            updateAdminProductsList();
            filteredProducts = [...products];
            generateCatalog();
            alert('Precio actualizado correctamente');
        }

        function cancelEditPrice(){
            editingPriceIndex = -1;
            updateAdminProductsList();
        }

        function deleteProduct(index){
            if (confirm(`¬øEliminar "${products[index].title}"?`)){
                products.splice(index,1);
                editingPriceIndex = -1;
                saveProductsToStorage();
                filteredProducts = [...products];
                updateAdminProductsList();
                generateCatalog();
                alert('Producto eliminado correctamente');
            }
        }

        function handlePinInput(){
            const inputs = document.querySelectorAll('.pin-digit');
            inputs.forEach((input,idx)=>{
                input.addEventListener('input',function(){ if(this.value.length===1 && idx<inputs.length-1){ inputs[idx+1].focus(); } });
                input.addEventListener('keydown',function(e){ if(e.key==='Backspace' && this.value.length===0 && idx>0){ inputs[idx-1].focus(); } });
            });
        }

        // ===== Init =====
        document.addEventListener('DOMContentLoaded', function(){
            // Carga persistente (si existe), si no, usa DEFAULT_PRODUCTS
            const loaded = loadProductsFromStorage();
            if (!loaded || products.length === 0) {
                products = [...DEFAULT_PRODUCTS];
                saveProductsToStorage();
            }

            filteredProducts = [...products];
            generateCatalog();

            // Verificar si hay un producto en la URL
            const urlProduct = getProductFromURL();
            if (urlProduct) {
                openLandingPage(urlProduct);
            }

            // Listeners principales
            document.getElementById('close-landing').addEventListener('click', closeLandingPage);
            document.getElementById('purchase-form').addEventListener('submit', submitForm);
            document.getElementById('customer-quantity').addEventListener('change', updateTotalPrice);

            document.getElementById('share-product-btn').addEventListener('click', function() {
                if (currentProduct) shareProduct(currentProduct);
            });

            // Cierre por click en fondo (opcional). Para evitar cierres accidentales, paramos propagaci√≥n dentro de contenido.
            document.getElementById('landing-page').addEventListener('click', function(e){ if(e.target===this){ closeLandingPage(); }});
            document.getElementById('admin-panel').addEventListener('click', function(e){ if(e.target===this){ closeAdminPanel(); }});

            // *** Anti-cierre accidental dentro de los contenedores ***
            document.querySelector('.landing-content')?.addEventListener('click', (e)=> e.stopPropagation());
            document.querySelector('.admin-content')?.addEventListener('click', (e)=> e.stopPropagation());

            // Admin
            document.getElementById('admin-btn').addEventListener('click', openAdminPanel);
            document.getElementById('close-admin').addEventListener('click', closeAdminPanel);
            document.getElementById('verify-pin').addEventListener('click', verifyPin);
            document.getElementById('new-product-form').addEventListener('submit', addNewProduct);
            handlePinInput();

            // Filtros
            document.getElementById('search-input').addEventListener('input', filterProducts);
            document.getElementById('price-filter').addEventListener('change', filterProducts);
        });
    </script>
</body>
</html>
